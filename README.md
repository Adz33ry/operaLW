# Opera Live Wallpaper (operaLW)

Невелика десктоп‑утиліта для macOS, що пакує відео у тему шпалер для Opera/Opera GX. Додаток дозволяє перетягнути відеофайл, обрізати за бажанням, за потреби адаптивно обрізати під 16:9, перекодувати у VP9 та встановити як тему шпалер у браузері.

## Можливості
- Перетягніть відео або оберіть через «Add» (`.mp4`, `.mov`, `.webm`, `.gif`).
- Автовизначення метаданих (тривалість, роздільність, FPS, VFR).
- Необов’язкове обрізання фрагмента за часом (Start/End).
- Адаптивний crop до 16:9 або «No crop».
- Вибір висоти кодування: 1080p/1440p/2160p (один із варіантів).
- Експорт і встановлення теми в директорію Opera GX (потрібне перезапускання браузера).

## Вимоги
- macOS 12.0+.
- FFmpeg (разом із `ffprobe`) має бути встановлений у системі.
  - Рекомендовано через Homebrew: `brew install ffmpeg`.

## Встановлення й запуск
- Готовий білд: згенеруйте `.dmg` і встановіть програму
  - `pnpm install`
  - `pnpm tauri:build`
  - Встановіть створений `Opera Live Wallpaper.dmg` і запустіть програму з «Програм».

- Запуск для розробки (dev):
  - `pnpm install`
  - `pnpm tauri:dev`

## Як користуватись
1. Запустіть додаток і перетягніть відеофайл у вікно або натисніть «Add».
2. Дочекайтеся відображення метаданих (тривалість, розмір, FPS).
3. За потреби задайте обрізання (Start/End) або натисніть «Don't Trim».
4. Оберіть бажану висоту (1080p / 1440p / 2160p) чи увімкніть «No crop».
5. Натисніть «Install». Пакет теми буде збережено у папці тем Opera GX.
6. Перезапустіть Opera/Opera GX та виберіть нову тему в налаштуваннях браузера.

Куди зберігається пакет теми (macOS):
- `~/Library/Application Support/com.operasoftware.OperaGX/themes/` — ZIP із темою.

Тимчасові файли:
- `~/Library/Caches/opera-lw/` — проміжні файли кодування видаляються після завершення експорту.

## Налаштування FFmpeg у встановленому додатку
Коли додаток запускається з Finder, він може не бачити змінний `PATH`. Програма шукає `ffmpeg`/`ffprobe` автоматично у типових місцях (Homebrew: `/opt/homebrew/bin`, Intel: `/usr/local/bin`, системні: `/usr/bin`).

Якщо FFmpeg встановлено в нетиповий шлях — задайте змінні середовища з повними шляхами до бінарників:
- `OPERALW_FFMPEG=/повний/шлях/до/ffmpeg`
- `OPERALW_FFPROBE=/повний/шлях/до/ffprobe`

Перевірка наявності FFmpeg (у терміналі):
- `/opt/homebrew/bin/ffmpeg -version` (Apple Silicon)
- `/usr/local/bin/ffmpeg -version` (Intel)

Запуск встановленого додатку з терміналу (для діагностики):
- `/Applications/Opera Live Wallpaper.app/Contents/MacOS/opera-lw`

## Збірка фронтенду вручну
- `pnpm build` — збирає статику у `dist/`. У Tauri це робиться автоматично через `beforeBuildCommand`.

## Технічні деталі
- Фреймворк: Tauri v2 (Rust + Vite/TypeScript фронтенд).
- Відеокодек: VP9 (`libvpx-vp9`, `-crf 30`, CFR до 30 FPS). Постер: перший кадр JPG.
- Файл теми — ZIP із `persona.ini`, `background.webm`, `first_frame_start_page.jpg` у корені архіву.

## Підтримка
Якщо сподобався інструмент — можна «підвезти каву»: https://ko-fi.com/K3K21NBUDO

## Відомі обмеження
- Наразі експорт іде до папки Opera GX; підтримка інших директорій Opera може з’явитися пізніше.
- Для дуже довгих відео кодування може тривати значний час.

## Ліцензія
Ліцензія на FFmpeg див. у `LICENSES/ffmpeg.txt`. Ліцензія на сам застосунок уточнюється автором репозиторію.
